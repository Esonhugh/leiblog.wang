---
title: 再见，电子设计
top: 10
categories:
  - Life
tags:
  - EEEE
date: 2020-10-24 13:33:50

---

### 0x 我与电子设计

从一年级到四年级，我一共参加了三次大学生电子设计竞赛，这份经历十分难得也同样很难忘，自从二年级获得全国大学生电子设计竞赛全国一等奖之后，我本着带带学弟学妹的心态和吴佳昱一起给低年级的学弟学妹们上一些培训课。但这些分享比起隔壁自动化学院实验室的传承差的还是很多，学院对电子设计竞赛的重视自我上一年级的时候才起步，很多东西都还在探索阶段，也许学院差的是一个或者两个，能有时间做出贡献的人。比如我认识的取得非常好的竞赛成绩，但是却选择就业的肖智中。

{% colorquote success %}

我和吴佳昱虽然都已经推免，但并不是大家想的推免之后就十分轻松，这只不过是另一段辛苦修行的开始。

{% endcolorquote %}

![Banner](http://leiblog.wang/static/image/2020/10/IMG_2065.JPG)

<!-- more -->

其实参赛除了“带带学弟”这个冠冕堂皇的理由之外，还是自己想再拿个一等奖，这样从一年级开始我就连续获得三次一等奖，那就很神了，这次比赛的时候我的代码风格与前两次完全不同，以往都是毫无感情的堆砌代码，而这次更像是把我三年来所学融会贯通，在不上OS的情况下使用了任务调度、动态阈值、平滑滤波等等算法，但遗憾的是翻车了，翻车的原因有很多，下面慢慢总结吧。

![](http://leiblog.wang/static/image/2020/10/IMG_2068.JPG)

### 1x A:无线运动传感器节点设计

一年级参加省电子设计竞赛的时候我就发现，虽然名义上是省赛，但是全国各地的题目都差不多。二年级参加国赛后发现比省赛要严格的多，而且多了很多环节，比如综合测评，四天三夜发挥能力，缺少睡眠，再来个一天不吃饭完成设计，我相信能坚持到综合测评的人都会对这段经历有着刻苦铭心的经历，毕竟一个人一般这辈子只能有一次，最多两次综合测评的机会。

今年的赛题出的时间很特殊，居然是提前一天晚上八点，当天晚上就确定了题目，因为心电信号的模拟和采集在器件清单公布之后我们就调试完了，毕竟这道题很好猜，肯定也有一大堆人和我们一样因为这个原因选择了A题，这就是入坑的开始，因为心电信号的采集不仅仅是最难的，而且仅是该题目的四分之一。

赛题要求是基于 TI 模拟前端芯片 ADS1292 和温度传感器 LMT70 设计制作无线运动传感器节点，节点采用电池供电，要求能稳定采集和记录使用者的心电信息、体表温度和运动信息。

有关赛题的具体需求详见：https://leiblog.wang/static/2020-10-05/2020年TI杯江苏省大学生电子设计竞赛题.zip

本次电子设计竞赛编写的程序可以在这里下载：

#### 1.1x 心电信号

首先，心电信号的采集使用的是赛题指定的ADS1292，理论上该芯片是专门用于心电，不会存在什么问题。

为了在TFT-LCD上显示波形，做了个简单的示波器，该示波器由我之前完成本校的Project3.4改编而来:https://github.com/LeiWang1999/stm32f407_hdb3

关于画波形其实我们讨论了两种解决方案：

- 都塞在while循环里，一次采集一个点，每采集到一个点就刷新示波器。
- 一次采集800个点，绘制一幅完整的图。

我其实倾向第二个解决方案，但是刚开始考虑到处理速度，就上了第一种，为后来的数字滤波埋下了巨坑。

用模拟器在ADS1292上表现十分优秀，但是换成真人信号差异很大，主要是因为两点：

1. 引入了50Hz左右的工频躁声
2. 引入了白噪声

对第一个噪声，因为心电信号主要是0.2Hz-2Hz(1秒5下-1秒0.5下)，所以设计一个低通滤波器就完事了，但是50Hz的低通还是很难做对的，更因为统一采购买的ADS1292没有片上的模拟滤波器，还需要占用MPU不多的算力制作数字滤波。

至于数字滤波器的选择，我很久之前写过一篇blog:[Matlab、图像IIR、FIR滤波](https://leiblog.wang/Matlab%E3%80%81%E5%9B%BE%E5%83%8FIIR%E3%80%81FIR%E6%BB%A4%E6%B3%A2/)，经过滤波器会产生一定的延时，阶数越高，延时越大，由于相同指标下，FIR 的阶数比 IIR 的阶数要高，所以其产生的延时越大，效果也越差一点。但是由于 FIR 是线性相位，每一个点的延时都是相同的， 所以很好进行修正。

